<div align="center">
  <img src="https://capsule-render.vercel.app/api?type=waving&color=0:FF0000,100:FFA500&height=240&text=SKN01-4th-3Team&animation=&fontColor=ffffff&fontSize=90" width="1000" />

  <img width="1000" alt="image" src="https://github.com/Jh-jaehyuk/Jh-jaehyuk.github.io/assets/126551524/7ea63fc3-95f0-44d5-a0f0-cf431cae34f1"> 
</div>

# 1. 팀 소개
### ▶️ 팀명 : LMS(Language Models)
<div style="font-size: 9px; color: #DCDCDC;">
  LMS는 Large Language ModelS의 약자로, language model 기술을 연구하고 개발하고자 하는 목표로 한 뜻을 이루고 있습니다.<br>
  에레메스는 명품 브래드 에르메스(Hermès)처럼 고품질의 서비스와 혁신을 제공하기 위해 노력합니다.<br><br>
</div>
<table align=center>
  <tbody>
    <tr>
      <td align=center><b>최민지</b></td>
      <td align=center><b>이민재</b></td>
      <td align=center><b>이근</b></td>
      <td align=center><b>이재호</b></td>
      <td align=center><b>이현석</b></td>
    </tr>
    <tr>
      <td align="center">
        <div>
          <img src="https://github.com/user-attachments/assets/297a0d13-f703-47d1-ba95-4f8c65d09629" width=200px; height=160px; alt=""/>
        </div>
      </td>
      <td align="center">
        <div>
          <img src="https://github.com/user-attachments/assets/1142396f-818f-4d5e-8368-2e668b2d3fdb" width=200px; height=160px; alt=""/>
        </div>
      </td>
      <td align="center">
        <div>
          <img src="https://github.com/user-attachments/assets/fe25e120-470a-4258-923f-cc8c28996aee" width=200px; height=160px; alt=""/>
        </div>
      </td>
      <td align="center">
        <div>
          <img src="https://github.com/user-attachments/assets/cbf3a37a-a3de-43cd-afcd-6fe6445af31c" width=200px; height=160px; alt=""/>
        </div>
      </td>
      <td align="center">
        <div>
          <img src="https://github.com/user-attachments/assets/0fbfd10a-51c4-4a66-8961-1054847f12ef" width=200px; height=160px; alt=""/>
        </div>
      </td>
    </tr>
    <tr>
      <td><a href="https://github.com/Minn-ji"><div align=center>@Minn-ji</div></a></td>
      <td><a href="https://github.com/Meue-L"><div align=center>@Meue-L</div></a></td>
      <td><a href="https://github.com/moneyandjelly "><div align=center>@moneyandjelly </div></a></td>
      <td><a href="https://github.com/gigcot"><div align=center>@gigcot</div></a></td>
      <td><a href="https://github.com/llee_hs"><div align=center>@llee_hs</div></a></td>
    </tr>
  </tbody>
</table>
<br>

# 2. 프로젝트 개요

### ▶️ 프로젝트 명
LLM 기반 사용자 맞춤 레시피 제공 챗봇 서비스

### ▶️ 프로젝트 소개
Corner-Chef는 특별하고 독창적인 레시피를 제안하는 사용자 맞춤형 LLM 기반 챗봇 서비스입니다.<br>
냉장고에 있는 식재료들을 채팅창에 입력하면 해당 재료를 활용한 레시피를 제공받을 수 있습니다. 

### ▶️ 기획 배경

1. 요리에 대한 관심 증가
- 최근 TV에서 요리 관련 프로그램의 인기 증가와 요리사들의 활발한 방송 활동, 요리 유튜버들의 구독자 수 증가 추이 등을 통해 개개인의 요리에 대한 관심도가 높아지고 있음을 확인했습니다.

2. 특별한 레시피를 생성하는 챗봇<br>
  - vanilla LLM 모델이 제공할 수 있는 단순한 레시피를 넘어선 특별하고 독창적인 레시피를 제안하는 모델을 통해 사용자들에게 맞춤형 레시피를 제공하고자 합니다.

### ▶️ Corner-Chef만의 차별성
1. 레시피 음성 제공
   - 이용자가 요리를 진행하는 과정에서 손을 자유롭게 사용할 수 없는 상황을 고려하여 레시피를 음성으로 제공받을 수 있습니다.
<br>

2. Business Model
   - Corner-Chef와의 대화를 위해서는 채팅 이용권(Ticket)을 구매해야 합니다.
   - Ticket을 구매하기 위해서는 Corner-Chef만의 재화인 'Cherry'를 충전해야 하며, Cherry를 사용하면 Ticket 뿐만 아니라 식재료 상점에서 식재료를 구입할 수 있습니다.
   - 'Cherry'는 직접 결제하거나, 출석체크 보상을 통해 충전할 수 있습니다.<br>

### ▶️ 주요 기능
1. 사용자 맞춤 레시피 생성 기능
2. 레시피를 음성을 읽어주는 TTS 기능
3. 음성으로 채팅을 입력할 수 있는 STT 기능
4. 생성된 레시피를 저장 기능 제공

<br>

# 3. ERD
<img src="https://github.com/user-attachments/assets/f14df5f2-f8be-4820-95fa-cbfd06283a40" width=700px; alt=""/>
<br><br>

# 4. 애자일 보드
### ▶️ Backend
- 요구사항 정의서 (Django로 데이터 관리)
<img src="https://github.com/user-attachments/assets/8678a9e1-5eda-4382-b3ae-7e3eb134c31b" width=900px; alt=""/>
<br>

### ▶️ Frontend
- 화면 설계서 (Vue로 페이지 구성)
<img src="https://github.com/user-attachments/assets/85f16129-f04c-48b2-9714-75b6e686e2ba" width=900px; alt=""/>
<br>

### ▶️ FastAPI
- AI 서빙 설계서
<img src="https://github.com/user-attachments/assets/89ac55a8-906c-4071-9963-3e318318472b" width=500px; alt=""/>
<br>

### ▶️ AI-Client
- AWS 비용 최적화를 위한 DLLS구성
<img src="https://github.com/user-attachments/assets/3edd2bd3-5a5e-4d62-a40c-2358f2cf1ee2" width=500px; alt=""/>
<br><br>

# 5-1. 서비스 흐름
<img src="https://github.com/user-attachments/assets/652e70dd-1610-4936-9668-08d305d3551e" width=700px; alt=""/>
<br><br>

# 5-2. 서비스 구성도
<img src="https://github.com/user-attachments/assets/80c9dc36-7375-409b-a2e2-b9d18d20bbeb" width=700px; alt=""/>
<br><br>

# 6. FastAPI - DLLS 구성에서 Fine Tuning 진행
OpenAI API를 활용한 gpt-4 model을 fine-tuning하여 모델 성능을 개선하고자 했으나, 시간 및 비용을 고려하였을 때 좋지 않은 결과가 도출되었습니다.
따라서, 더 나은 결과 도출을 위해 Langchain을 활용하여 RAG 기반 LLM을 구축하였습니다.<br>

- langchain의 RunnableWithMessageHistory() 체인 기반 RAG 시스템 구축
```
  chain = (
          {
              "context": itemgetter("question") | faiss_index.as_retriever(), # retriever
              "question": itemgetter("question"),
              "chat_history": itemgetter("chat_history"),
          }
          | prompt # 프롬프트 추가
          | llm
          | StrOutputParser() # 언어 모델의 출력을 문자열로 변환
  )

  qa_chain = RunnableWithMessageHistory(
      chain,
      self.get_session_history,
      input_messages_key="question",  # 사용자의 질문이 템플릿 변수에 들어갈 key
      history_messages_key="chat_history",  # 기록 메시지의 키
  )

  return qa_chain
```

- chain에 사용한 promptTemplate
```
def generatePrompt(self):
    prompt = ChatPromptTemplate.from_messages(
        [
            (
                "system",
                "당신은 주어진 재료를 기반으로 레시피를 생성하는 챗봇입니다. 질문에 대한 답변을 제공해 주세요. "
                "[레시피 명], [요리 인분 수], [재료], [요리 과정]을 []를 사용하여 명시해 주세요.",
            ),
            MessagesPlaceholder(variable_name="chat_history"),
            ("human", "{question}"),
        ]
    )
    return prompt
```
<br>

# 7. QA Dataset
- 레시피 QA 데이터를 생성합니다.
```
def make_qa_json(df):
    cleaned_ingredients = [remove_units_for_ingredient(item) for item in df['CKG_MTRL_CN']]
    df['clean_ingredient'] = cleaned_ingredients

    rag_data = []
    for i in range(len(df)):
        question = f"{df['clean_ingredient'][i]}로 할 수 있는 요리 레시피 알려줘."
        answer = (f"말씀하신 재료로 할 수 있는 요리 레시피를 알려드리겠습니다."
                  f"[레시피 명] {df['CKG_NM'][i]}"
                  f"[재료] {df['CKG_MTRL_CN'][i]}"
                  f"[요리 인분 수] {df['CKG_INBUN_NM'][i]}인분"
                  f"[요리 분류] {df['CKG_MTH_ACTO_NM'][i]}"
                  f"[요리 과정] {df['RCP_CONTENT'][i]}"
                  f"맛있는 식사 되세요!")
        rag_data.append({'question': question, 'answer': answer})
```
<br>

- FAISS를 사용하기 위해 QA dataset을 하나의 QA 단위로 나눕니다. 이후 vector로 변경하여 .json 파일로 저장합니다.
  Semantic text chunk를 사용한 dataset을 chunking을 시도하였으나, 하나의 QA 단위로 chunking하는 것이 가장 좋은 결과를 도출했습니다.
  - 따라서 FAISS를 사용하기 위해 텍스트를 청크 단위로 나눈 후 Document 형태로 변환했습니다.
```
def loadDocumentation(self, filepath):
    with open(filepath, 'r', encoding='utf-8') as f:
        qa_data = json.load(f)

    documents = []
    for item in qa_data:
        question = item['question']
        answer = item['answer']
        documents.append(f"Question: {question}\nAnswer: {answer}")
    return documents
```

문서 검색 속도를 개선하기 위해 FAISS 벡터 파일을 생성한 뒤 load합니다.
```
async def createFaissIndex(self, texts, embedding):
    faissIndex = FAISS.from_texts(texts=texts, embedding=embedding)
    faissIndex.save_local(self.FAISS_INDEX_PATH)
```
```
def loadFaissIndex(self, faissIndexPath, embeddings):
    faissIndex = FAISS.load_local(folder_path=faissIndexPath, embeddings=embeddings, allow_dangerous_deserialization=True)
    return faissIndex
```
<br>

# 8. 보안 설정을 위한 TLS / SSL 소켓 구성
![소켓구성](https://github.com/user-attachments/assets/adb76d5d-ab08-4801-baab-b4c4f2a888b7)

- 소켓 통신 구성 시, 로컬 서버는 보안에 매우 취약한 상태에 있습니다.
- 보안 취약성을 이용하여 서버가 공격 당할 위험성이 있기 때문에 TLS/SSL 통신을 위한 보안 인증서를 만들어 통신을 진행하였습니다.
<br><br>

# 9. 사용한 기술 스택
<div align=left><h3>🖥️ Frontend</div>
<div align=left>
  <img src="https://img.shields.io/badge/Vue.js-4FC08D?style=for-the-badge&logo=Vue.js&logoColor=white">
  <img src="https://img.shields.io/badge/Vuetify-1867C0?style=for-the-badge&logo=Vuetify&logoColor=white">
  <img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white">
  <img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=TypeScript&logoColor=white">
  <img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=Axios&logoColor=white">
  <img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white">
  <img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=HTML5&logoColor=white">
</div>

<div align=left><h3>💾 Backend</div>
<div aling=left>
  <img src="https://img.shields.io/badge/Django-092E20?style=for-the-badge&logo=Django&logoColor=white">
  <img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=Python&logoColor=white">
  <img src="https://img.shields.io/badge/Pandas-150458?style=for-the-badge&logo=Pandas&logoColor=white">
  <img src="https://img.shields.io/badge/Redis-FF4438?style=for-the-badge&logo=Redis&logoColor=white">
  <img src="https://img.shields.io/badge/KakaoDev-221E68?style=for-the-badge&logo=Kakao&logoColor=white">
  <img src="https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=FastAPI&logoColor=white">
  <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">
  <img src="https://img.shields.io/badge/MongoDB-47A248?style=for-the-badge&logo=MongoDB&logoColor=white"/>
</div>

<div align=left><h3>🤖 AI Core</div>
<div align=left>
  <img src="https://img.shields.io/badge/OpenAI-412991?style=for-the-badge&logo=OpenAI&logoColor=white">
  <img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=Python&logoColor=white">
</div>

<div align=left><h3>🟧 Deploy & Infra</div>
<div align="left">
  <img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white">
  <img src="https://img.shields.io/badge/GitHub Runner-2088FF?style=for-the-badge&logo=GitHub Runner&logoColor=white">
  <img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon Web Services-232F3E?style=for-the-badge&logo=Amazon Web Services&logoColor=white">
  <img src="https://img.shields.io/badge/NGINX-009639?style=for-the-badge&logo=NGINX&logoColor=white">
</div>

<div align=left><h3>▶️ Dev Tool </div>
<div align="left">
  <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white">
  <img src="https://img.shields.io/badge/Pycharm-000000?style=for-the-badge&logo=Pycharm&logoColor=white">
  <img src="https://img.shields.io/badge/Visual Studio Code-008CFF?style=for-the-badge&logo=Visual Studio Code&logoColor=white">
</div>
  
<div align=left><h3>📢 Communication </div>
<div align="left">
  <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white">
  <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white">
  <img src="https://img.shields.io/badge/Discord-5865F2?style=for-the-badge&logo=Discord&logoColor=white">
</div>
<br><br>

# 10. 시연 결과
시연 결과는 그냥 저희 서비스 링크를 거는게 좋을거 같습니다
<br><br>

# 11. 한 줄 회고
__🗨️ 최민지__
- 서비스를 AWS에 배포해볼 수 있었던 좋은 경험이었습니다. 많은 이슈들을 겪었지만 팀원들과 함께 핸들링하며 무사히 프로젝트를 마무리할 수 있었습니다.

__🗨️ 이민재__
- 우여곡절이 많았지만, 어찌저찌 이번 프로젝트도 잘 마무리 되었네요. 각자의 자리에서 고생한 팀원분들 정말 고생 많으셨습니다. 최종까지 잘 마무리 하시고, 각자의 자리에서 행복하시길 바랍니다.

__🗨️ 이근__
- 각자 자기 위치에서 최선을 다해서 프로젝트를 하는 동안 너무 마음이 편했습니다.

__🗨️ 이재호__
- 간단해 보이는 기능들도 생각보다 아주 복잡하다는걸 느꼈습니다.

__🗨️ 이현석__
- 팀장으로서 맡은 일도 많으신데 프로젝트를 너무 잘 이끌어주신 민지님, DevOps에서 맹활약하시면서 팀원들 스터디까지 챙겨주신 민재님, Front와 Back에서 총대 매고 많은 것들을 작업하시고 저까지 많이 알려주시면서 해주신 근님, 묵묵듬직하게 FineTuning 하시느라 고생하신 재호님까지 좋은 팀원들을 만나 많은 것을 배우고 느낄 수 있던 프로젝트였습니다. 감사했습니다.
